<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>pico-scale: pico-scale</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">pico-scale
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">pico-scale </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>A scale API for a Raspberry Pi Pico (RP2040) using the <a href="https://github.com/endail/hx711-pico-c">hx711-pico-c library</a>.</p>
<p><img src="resources/hx711_serialout.gif" alt="resources/hx711_serialout.gif" class="inline"/></p>
<p>The .gif above illustrates the <a href="main.c">current example code</a> obtaining data from a HX711 operating at 80 samples per second. Each line shows the current weight calculated from all samples obtained within 250 milliseconds, along with the minimum and maximum weights of the scale since boot. I applied pressure to the load cell to show the change in weight.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Clone</h1>
<h2><a class="anchor" id="autotoc_md2"></a>
Method 1</h2>
<p>If you want to use this repository as-is with the example code, clone the respository and initialise the <code>hx711-pico-c</code> submodule.</p>
<div class="fragment"><div class="line">git clone https://github.com/endail/pico-scale</div>
<div class="line">git submodule update --init</div>
</div><!-- fragment --><p>Then <code>#include</code> as follows:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="scale_8h.html">include/scale.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;extern/hx711-pico-c/include/hx711_noblock.pio.h&quot;</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md3"></a>
Method 2</h2>
<p>Alternatively, if you want to use the scale functionality as an API in your own project, add <code>pico-scale</code> as a submodule and then initialise it.</p>
<div class="fragment"><div class="line">git submodule add https://github.com/endail/pico-scale extern/</div>
<div class="line">git submodle update --init --recursive</div>
</div><!-- fragment --><p>Then, from your own code, <code>#include</code> the relevant files as follows and initialise the hx711:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;extern/pico-scale/include/scale.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;extern/pico-scale/extern/hx711-pico-c/include/hx711_noblock.pio.h&quot;</span></div>
</div><!-- fragment --><p>See the explanation <a href="https://github.com/endail/hx711-pico-c#custom-pio-programs">here</a> for why you need to manually include the PIO program.</p>
<h1><a class="anchor" id="autotoc_md4"></a>
Documentation</h1>
<p><a href="https://endail.github.io/pico-scale/">https://endail.github.io/pico-scale</a></p>
<h1><a class="anchor" id="autotoc_md5"></a>
Initialise the HX711</h1>
<p>You will always need to initialise the HX711 before using it as a scale, so do this first:</p>
<div class="fragment"><div class="line">hx711_t hx;</div>
<div class="line"> </div>
<div class="line">hx711_init(</div>
<div class="line">    &amp;hx,</div>
<div class="line">    clkPin,</div>
<div class="line">    datPin,</div>
<div class="line">    pio0,</div>
<div class="line">    &amp;hx711_noblock_program,</div>
<div class="line">    &amp;hx711_noblock_program_init);</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md6"></a>
How to Use the HX711 as a Scale</h1>
<div class="fragment"><div class="line"><a class="code" href="structscale__t.html">scale_t</a> sc;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// the values obtained when calibrating the scale</span></div>
<div class="line"><span class="comment">// if you don&#39;t know them, read the following section How to Calibrate</span></div>
<div class="line"><a class="code" href="mass_8h.html#a63594d9cf123405a03d0ab838daa9a27">mass_unit_t</a> scaleUnit = <a class="code" href="mass_8h.html#a63594d9cf123405a03d0ab838daa9a27a0c784ed2f761029d8d4bd33c07612dfb">mass_g</a>;</div>
<div class="line">int32_t refUnit = -432;</div>
<div class="line">int32_t offset = -367539;</div>
<div class="line"> </div>
<div class="line"><a class="code" href="scale_8h.html#ad23bc7d5d57a3c196dffb60866088bb4">scale_init</a>(</div>
<div class="line">    &amp;sc,</div>
<div class="line">    &amp;hx, <span class="comment">// pass a pointer to the hx711_t</span></div>
<div class="line">    scaleUnit,</div>
<div class="line">    refUnit,</div>
<div class="line">    offset);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// 3. Set options for how the scale will read and interpret values</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// SCALE_DEFAULT_OPTIONS will give some default settings which you</span></div>
<div class="line"><span class="comment">// do not have to use</span></div>
<div class="line"><a class="code" href="structscale__options__t.html">scale_options_t</a> opt = <a class="code" href="scale_8h.html#a0ee40743499233ab7ded69bc522adcf3">SCALE_DEFAULT_OPTIONS</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// scale_options_t has the following options</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// opt.strat, which defines how the scale will collect data. By default,</span></div>
<div class="line"><span class="comment">// data is collected according to the number of samples. So opt.strat</span></div>
<div class="line"><span class="comment">// is set to strategy_type_samples. opt.samples defines how many samples</span></div>
<div class="line"><span class="comment">// to obtain. You can also set opt.strat to read_type_time which will</span></div>
<div class="line"><span class="comment">// collect as many samples as possible within the timeout period. The</span></div>
<div class="line"><span class="comment">// timeout period is defined by opt.timeout and is given in microseconds</span></div>
<div class="line"><span class="comment">// (us). For example, 1 second is equal to 1,000,000 us.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// opt.read, which defines how the scale will interpret data. By default,</span></div>
<div class="line"><span class="comment">// data is interpreted according to the median value. So opt.read is set</span></div>
<div class="line"><span class="comment">// to read_type_median. You can also set opt.read to read_type_average</span></div>
<div class="line"><span class="comment">// which will calculate the average value.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Example:</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// opt.strat = strategy_type_time;</span></div>
<div class="line"><span class="comment">// opt.read = read_type_average;</span></div>
<div class="line"><span class="comment">// opt.timeout = 250000;</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// These options mean... collect as many samples as possible within 250ms</span></div>
<div class="line"><span class="comment">// and then use the average of all those samples.</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// 4. Zero the scale (OPTIONAL) (aka. tare)</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span>(<a class="code" href="scale_8h.html#a2856aa7de7bc3367436768b16c7635d2">scale_zero</a>(&amp;sc, &amp;opt)) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;Scale zeroed successfully\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">else</span> {</div>
<div class="line">    printf(<span class="stringliteral">&quot;Scale failed to zero\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// 5. Obtain the weight</span></div>
<div class="line"><a class="code" href="structmass__t.html">mass_t</a> mass;</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span>(<a class="code" href="scale_8h.html#a3e40634ba10306170af7c5efd6763731">scale_weight</a>(&amp;sc, &amp;mass, &amp;opt)) {</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// mass will contain the weight on the scale obtanined and interpreted</span></div>
<div class="line">    <span class="comment">// according to the given options and be in the unit defined by the</span></div>
<div class="line">    <span class="comment">// mass_unit_t &#39;scaleUnit&#39; variable above</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// you can now:</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// get the weight as a numeric value according to the mass_unit_t</span></div>
<div class="line">    <span class="keywordtype">double</span> val;</div>
<div class="line">    <a class="code" href="mass_8h.html#adcc94737143cdd25beb95b665c04e6c5">mass_get_value</a>(&amp;mass, &amp;val);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// convert the mass to a string</span></div>
<div class="line">    <span class="keywordtype">char</span> buff[<a class="code" href="mass_8h.html#ae8be3e5bc64f2ae5441d61c5ee080a8f">MASS_TO_STRING_BUFF_SIZE</a>];</div>
<div class="line">    <a class="code" href="mass_8h.html#a367bf5be9ac90d196919b0d5fbf63d93">mass_to_string</a>(&amp;mass, buff);</div>
<div class="line">    printf(<span class="stringliteral">&quot;%s\n&quot;</span>, buff);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// or do other operations (see: mass.h file)</span></div>
<div class="line"> </div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">else</span> {</div>
<div class="line">    printf(<span class="stringliteral">&quot;Failed to read weight\n&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md7"></a>
How to Calibrate</h1>
<ol type="1">
<li>Modify <a href="calibration.c#L68-L75">the calibration program</a> and change the clock and data pins to those connected to the HX711. Also change the rate at which the HX711 operates if needed.</li>
<li>Build.</li>
<li>Copy <code>calibration.uf2</code> in the build directory to the Raspberry Pi Pico.</li>
<li>Open a serial connection to the Pico at a baud rate of 115200 and follow the prompts. </li>
</ol>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="astructscale__options__t_html"><div class="ttname"><a href="structscale__options__t.html">scale_options_t</a></div><div class="ttdef"><b>Definition:</b> <a href="scale_8h_source.html#l00047">scale.h:47</a></div></div>
<div class="ttc" id="astructmass__t_html"><div class="ttname"><a href="structmass__t.html">mass_t</a></div><div class="ttdef"><b>Definition:</b> <a href="mass_8h_source.html#l00089">mass.h:89</a></div></div>
<div class="ttc" id="ascale_8h_html_a2856aa7de7bc3367436768b16c7635d2"><div class="ttname"><a href="scale_8h.html#a2856aa7de7bc3367436768b16c7635d2">scale_zero</a></div><div class="ttdeci">bool scale_zero(scale_t *const sc, const scale_options_t *const opt)</div><div class="ttdef"><b>Definition:</b> <a href="scale_8c_source.html#l00231">scale.c:231</a></div></div>
<div class="ttc" id="amass_8h_html_adcc94737143cdd25beb95b665c04e6c5"><div class="ttname"><a href="mass_8h.html#adcc94737143cdd25beb95b665c04e6c5">mass_get_value</a></div><div class="ttdeci">static void mass_get_value(const mass_t *const m, double *const val)</div><div class="ttdef"><b>Definition:</b> <a href="mass_8h_source.html#l00112">mass.h:112</a></div></div>
<div class="ttc" id="amass_8h_html_a63594d9cf123405a03d0ab838daa9a27"><div class="ttname"><a href="mass_8h.html#a63594d9cf123405a03d0ab838daa9a27">mass_unit_t</a></div><div class="ttdeci">mass_unit_t</div><div class="ttdef"><b>Definition:</b> <a href="mass_8h_source.html#l00068">mass.h:68</a></div></div>
<div class="ttc" id="ascale_8h_html"><div class="ttname"><a href="scale_8h.html">scale.h</a></div></div>
<div class="ttc" id="astructscale__t_html"><div class="ttname"><a href="structscale__t.html">scale_t</a></div><div class="ttdef"><b>Definition:</b> <a href="scale_8h_source.html#l00061">scale.h:61</a></div></div>
<div class="ttc" id="amass_8h_html_a63594d9cf123405a03d0ab838daa9a27a0c784ed2f761029d8d4bd33c07612dfb"><div class="ttname"><a href="mass_8h.html#a63594d9cf123405a03d0ab838daa9a27a0c784ed2f761029d8d4bd33c07612dfb">mass_g</a></div><div class="ttdeci">@ mass_g</div><div class="ttdef"><b>Definition:</b> <a href="mass_8h_source.html#l00071">mass.h:71</a></div></div>
<div class="ttc" id="ascale_8h_html_a3e40634ba10306170af7c5efd6763731"><div class="ttname"><a href="scale_8h.html#a3e40634ba10306170af7c5efd6763731">scale_weight</a></div><div class="ttdeci">bool scale_weight(scale_t *const sc, mass_t *const m, const scale_options_t *const opt)</div><div class="ttdef"><b>Definition:</b> <a href="scale_8c_source.html#l00256">scale.c:256</a></div></div>
<div class="ttc" id="amass_8h_html_ae8be3e5bc64f2ae5441d61c5ee080a8f"><div class="ttname"><a href="mass_8h.html#ae8be3e5bc64f2ae5441d61c5ee080a8f">MASS_TO_STRING_BUFF_SIZE</a></div><div class="ttdeci">static const size_t MASS_TO_STRING_BUFF_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="mass_8h_source.html#l00063">mass.h:63</a></div></div>
<div class="ttc" id="ascale_8h_html_a0ee40743499233ab7ded69bc522adcf3"><div class="ttname"><a href="scale_8h.html#a0ee40743499233ab7ded69bc522adcf3">SCALE_DEFAULT_OPTIONS</a></div><div class="ttdeci">static const scale_options_t SCALE_DEFAULT_OPTIONS</div><div class="ttdef"><b>Definition:</b> <a href="scale_8h_source.html#l00054">scale.h:54</a></div></div>
<div class="ttc" id="amass_8h_html_a367bf5be9ac90d196919b0d5fbf63d93"><div class="ttname"><a href="mass_8h.html#a367bf5be9ac90d196919b0d5fbf63d93">mass_to_string</a></div><div class="ttdeci">int mass_to_string(const mass_t *const m, char *const buff)</div><div class="ttdef"><b>Definition:</b> <a href="mass_8c_source.html#l00026">mass.c:26</a></div></div>
<div class="ttc" id="ascale_8h_html_ad23bc7d5d57a3c196dffb60866088bb4"><div class="ttname"><a href="scale_8h.html#ad23bc7d5d57a3c196dffb60866088bb4">scale_init</a></div><div class="ttdeci">void scale_init(scale_t *const sc, hx711_t *const hx, const mass_unit_t unit, const int32_t ref_unit, const int32_t offset)</div><div class="ttdef"><b>Definition:</b> <a href="scale_8c_source.html#l00028">scale.c:28</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sat Aug 6 2022 14:43:59 for pico-scale by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
